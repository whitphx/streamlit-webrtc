(this.webpackJsonpstreamlit_webrtc=this.webpackJsonpstreamlit_webrtc||[]).push([[0],{48:function(e,t,n){"use strict";(function(e){var r=n(12),i=n(10),a=n(4),o=n.n(a),s=n(7),c=n(0),l=n(3),u=n(1),d=n(2),f=n(25),p=n(5),v=n.n(p),g=n(44),h=n(50),b=n(49),j=function(e){return"RECVONLY"===e||"SENDONLY"===e||"SENDRECV"===e},O=function(e){return e.createOffer().then((function(t){return console.log("Created offer:",t),e.setLocalDescription(t)})).then((function(){return console.log("Wait for ICE gethering..."),new Promise((function(t){if("complete"===e.iceGatheringState)t();else{e.addEventListener("icegatheringstatechange",(function n(){"complete"===e.iceGatheringState&&(e.removeEventListener("icegatheringstatechange",n),t())}))}}))})).then((function(){return e.localDescription})).catch((function(e){throw console.error(e),e}))},m=function(t){Object(u.a)(a,t);var n=Object(d.a)(a);function a(t){var l;return Object(c.a)(this,a),(l=n.call(this,t)).pc=void 0,l.videoRef=void 0,l.audioRef=void 0,l.processAnswerInner=function(){var e=Object(s.a)(o.a.mark((function e(t,n){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=JSON.parse(n),console.log("Receive answer sdpOffer",r),e.next=4,t.setRemoteDescription(r);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),l.processAnswer=function(e,t){l.processAnswerInner(e,t).then((function(){console.log("Remote description is set")})).finally((function(){return l.setState({signaling:!1})}))},l.startInner=Object(s.a)(o.a.mark((function e(){var t,n,r,a,s,c,u,d,p,v;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.props.args.mode,j(n)){e.next=3;break}throw new Error("Invalid mode ".concat(n));case 3:if(l.setState({signaling:!0,hasVideo:!1,hasAudio:!1}),r=(null===(t=l.props.args.settings)||void 0===t?void 0:t.rtc_configuration)||{},console.log("RTCConfiguration:",r),a=new RTCPeerConnection(r),"SENDRECV"!==n&&"RECVONLY"!==n||a.addEventListener("track",(function(e){if("video"===e.track.kind){var t=l.videoRef.current;if(null==t)return void console.error("video element is not mounted");t.srcObject=e.streams[0],l.setState({hasVideo:!0})}else{var n=l.audioRef.current;if(null==n)return void console.error("audio element is not mounted");n.srcObject=e.streams[0],l.setState({hasAudio:!0})}})),"SENDRECV"!==n&&"SENDONLY"!==n){e.next=20;break}if(c={audio:!0,video:!0},u=(null===(s=l.props.args.settings)||void 0===s?void 0:s.media_stream_constraints)||c,console.log("MediaStreamConstraints:",u),!u.audio&&!u.video){e.next=17;break}return e.next=15,navigator.mediaDevices.getUserMedia(u);case 15:(d=e.sent).getTracks().forEach((function(e){a.addTrack(e,d)}));case 17:if("SENDONLY"===n){p=Object(i.a)(a.getTransceivers());try{for(p.s();!(v=p.n()).done;)v.value.direction="sendonly"}catch(o){p.e(o)}finally{p.f()}}e.next=21;break;case 20:"RECVONLY"===n&&(a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"}));case 21:l.setState({playing:!0}),console.log("transceivers",a.getTransceivers()),O(a).then((function(e){null!=e?(console.log("Send sdpOffer",e.toJSON()),f.a.setComponentValue({sdpOffer:e.toJSON(),playing:!0})):console.warn("Failed to create an offer SDP")})),l.pc=a;case 25:case"end":return e.stop()}}),e)}))),l.start=function(){l.startInner().catch((function(){return l.setState({signaling:!1})}))},l.stopInner=Object(s.a)(o.a.mark((function e(){var t;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.pc,l.pc=void 0,l.setState({playing:!1},(function(){return f.a.setComponentValue({playing:!1})})),null!=t){e.next=5;break}return e.abrupt("return",Promise.resolve());case 5:return t.getTransceivers&&t.getTransceivers().forEach((function(e){e.stop&&e.stop()})),t.getSenders().forEach((function(e){var t;null===(t=e.track)||void 0===t||t.stop()})),e.abrupt("return",new Promise((function(e){setTimeout((function(){t.close(),e()}),500)})));case 8:case"end":return e.stop()}}),e)}))),l.stop=function(){l.setState({stopping:!0}),l.stopInner().finally((function(){l.setState({stopping:!1,hasVideo:!1,hasAudio:!1})}))},l.render=function(){var t=l.props.disabled||l.state.signaling||l.state.stopping,n=l.props.args.mode,i=j(n)&&function(e){return"SENDRECV"===e||"RECVONLY"===e}(n);return Object(r.jsxs)(g.a,{children:[Object(r.jsxs)(b.a,{visible:i,onVisibilityChange:function(){return e(f.a.setFrameHeight)},children:[Object(r.jsx)(g.a,{children:Object(r.jsx)("video",{style:{width:"100%"},ref:l.videoRef,autoPlay:!0,controls:!0,onCanPlay:function(){return f.a.setFrameHeight()}})}),Object(r.jsx)(g.a,{children:Object(r.jsx)("audio",{ref:l.audioRef,autoPlay:!0,controls:!0})})]}),Object(r.jsx)(g.a,{children:l.state.playing?Object(r.jsx)(h.a,{variant:"contained",onClick:l.stop,disabled:t,children:"Stop"}):Object(r.jsx)(h.a,{variant:"contained",color:"primary",onClick:l.start,disabled:t,children:"Start"})})]})},l.videoRef=v.a.createRef(),l.audioRef=v.a.createRef(),l.state={signaling:!1,playing:!1,stopping:!1,hasVideo:!1,hasAudio:!1},l}return Object(l.a)(a,[{key:"componentDidUpdate",value:function(){if(null!=this.pc){var e=this.pc;if(null==e.remoteDescription){var t=this.props.args.sdp_answer_json;t&&this.processAnswer(e,t)}}}}]),a}(f.b);t.a=Object(f.c)(m)}).call(this,n(61).setImmediate)},49:function(e,t,n){"use strict";var r=n(12),i=n(9),a=n(30),o=n(5);t.a=function(e){var t,n=e.visible,s=void 0===n||n,c=e.onVisibilityChange,l=Object(a.a)(e,["visible","onVisibilityChange"]);return Object(o.useEffect)((function(){c(s)}),[s,c]),Object(r.jsx)("div",Object(i.a)({style:Object(i.a)(Object(i.a)({},l.style),{},{display:s?null===(t=l.style)||void 0===t?void 0:t.display:"none"})},l))}},51:function(e,t,n){"use strict";n.r(t);var r=n(12),i=n(5),a=n.n(i),o=n(26),s=n.n(o),c=n(45),l=n(73),u=n(74),d=n(48),f=Object(c.a)({overrides:{MuiCssBaseline:{"@global":{body:{backgroundColor:"initial"}}}}});s.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsxs)(l.a,{theme:f,children:[Object(r.jsx)(u.a,{}),Object(r.jsx)(d.a,{})]})}),document.getElementById("root"))}},[[51,1,2]]]);
//# sourceMappingURL=main.7a1f2599.chunk.js.map