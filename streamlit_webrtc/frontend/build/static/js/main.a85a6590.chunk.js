(this.webpackJsonpstreamlit_webrtc=this.webpackJsonpstreamlit_webrtc||[]).push([[0],{55:function(e,t,n){"use strict";n.r(t);var r=n(10),o=n(5),a=n.n(o),i=n(22),s=n.n(i),c=n(39),u=n(71),l=n(72),d=n(4),f=n.n(d),p=n(7),v=n(0),g=n(3),h=n(1),b=n(2),j=n(25),m=n(74),O=n(75),S=function(e,t){return"RECVONLY"===t&&(e.addTransceiver("video",{direction:"recvonly"}),e.addTransceiver("audio",{direction:"recvonly"})),e.createOffer().then((function(t){return console.log("Created offer:",t),e.setLocalDescription(t)})).then((function(){return console.log("Wait for ICE gethering..."),new Promise((function(t){if("complete"===e.iceGatheringState)t();else{e.addEventListener("icegatheringstatechange",(function n(){"complete"===e.iceGatheringState&&(e.removeEventListener("icegatheringstatechange",n),t())}))}}))})).then((function(){return e.localDescription})).catch((function(e){throw console.error(e),e}))},w=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(v.a)(this,n),(o=t.call(this,e)).pc=void 0,o.videoRef=void 0,o.audioRef=void 0,o.processAnswerInner=function(){var e=Object(p.a)(f.a.mark((function e(t,n){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=JSON.parse(n),console.log("Receive answer sdpOffer",r),e.next=4,t.setRemoteDescription(r);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),o.processAnswer=function(e,t){o.processAnswerInner(e,t).then((function(){console.log("Remote description is set")})).finally((function(){return o.setState({signaling:!1})}))},o.startInner=Object(p.a)(f.a.mark((function e(){var t,n,r,a,i,s,c,u;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.props.args.mode,"RECVONLY"===(l=n)||"SENDONLY"===l||"SENDRECV"===l){e.next=3;break}throw new Error("Invalid mode ".concat(n));case 3:if(o.setState({signaling:!0,hasVideo:!1,hasAudio:!1}),r=(null===(t=o.props.args.settings)||void 0===t?void 0:t.rtc_configuration)||{},console.log("RTCConfiguration:",r),(a=new RTCPeerConnection(r)).addEventListener("track",(function(e){if("video"===e.track.kind){var t=o.videoRef.current;if(null==t)return void console.error("video element is not mounted");t.srcObject=e.streams[0],o.setState({hasVideo:!0})}else{var n=o.audioRef.current;if(null==n)return void console.error("audio element is not mounted");n.srcObject=e.streams[0],o.setState({hasAudio:!0})}})),"SENDRECV"!==n&&"SENDONLY"!==n){e.next=17;break}if(s={audio:!0,video:!0},c=(null===(i=o.props.args.settings)||void 0===i?void 0:i.media_stream_constraints)||s,console.log("MediaStreamConstraints:",c),!c.audio&&!c.video){e.next=17;break}return e.next=15,navigator.mediaDevices.getUserMedia(c);case 15:(u=e.sent).getTracks().forEach((function(e){a.addTrack(e,u)}));case 17:o.setState({playing:!0}),S(a,n).then((function(e){null!=e?(console.log("Send sdpOffer",e.toJSON()),j.a.setComponentValue({sdpOffer:e.toJSON(),playing:!0})):console.warn("Failed to create an offer SDP")})),o.pc=a;case 20:case"end":return e.stop()}var l}),e)}))),o.start=function(){o.startInner().catch((function(){return o.setState({signaling:!1})}))},o.stopInner=Object(p.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.pc,o.pc=void 0,o.setState({playing:!1},(function(){return j.a.setComponentValue({playing:!1})})),null!=t){e.next=5;break}return e.abrupt("return",Promise.resolve());case 5:return t.getTransceivers&&t.getTransceivers().forEach((function(e){e.stop&&e.stop()})),t.getSenders().forEach((function(e){var t;null===(t=e.track)||void 0===t||t.stop()})),e.abrupt("return",new Promise((function(e){setTimeout((function(){t.close(),e()}),500)})));case 8:case"end":return e.stop()}}),e)}))),o.stop=function(){o.setState({stopping:!0}),o.stopInner().finally((function(){o.setState({stopping:!1,hasVideo:!1,hasAudio:!1})}))},o.render=function(){var e=o.props.disabled||o.state.signaling||o.state.stopping;return Object(r.jsxs)(m.a,{children:[Object(r.jsx)(m.a,{children:Object(r.jsx)("video",{style:{width:"100%"},ref:o.videoRef,autoPlay:!0,controls:!0,onCanPlay:function(){return j.a.setFrameHeight()}})}),Object(r.jsx)(m.a,{children:Object(r.jsx)("audio",{ref:o.audioRef,autoPlay:!0,controls:!0})}),Object(r.jsx)(m.a,{children:o.state.playing?Object(r.jsx)(O.a,{variant:"contained",onClick:o.stop,disabled:e,children:"Stop"}):Object(r.jsx)(O.a,{variant:"contained",color:"primary",onClick:o.start,disabled:e,children:"Start"})})]})},o.videoRef=a.a.createRef(),o.audioRef=a.a.createRef(),o.state={signaling:!1,playing:!1,stopping:!1,hasVideo:!1,hasAudio:!1},o}return Object(g.a)(n,[{key:"componentDidUpdate",value:function(){if(null!=this.pc){var e=this.pc;if(null==e.remoteDescription){var t=this.props.args.sdp_answer_json;t&&this.processAnswer(e,t)}}}}]),n}(j.b),x=Object(j.c)(w),k=Object(c.a)({overrides:{MuiCssBaseline:{"@global":{body:{backgroundColor:"initial"}}}}});s.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsxs)(u.a,{theme:k,children:[Object(r.jsx)(l.a,{}),Object(r.jsx)(x,{})]})}),document.getElementById("root"))}},[[55,1,2]]]);
//# sourceMappingURL=main.a85a6590.chunk.js.map